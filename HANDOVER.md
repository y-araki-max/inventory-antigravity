# プロジェクト最終引き継ぎ書 (Strict v13.3)

**重要**: 本ドキュメントは 2026年2月18日時点の最終決定版（v13.3）です。
`TypeError` を根絶するため、在庫表の計算ロジックを「インライン自己完結型」に再構築しました。

## 1. 唯一の正解ルール (Single Source of Truth)

### 計算エンジンの再構築 (Strict v13.3)
- **インライン計算**: 
    - 外部関数に依存するのではなく、`InventoryTable.jsx` の描画ループ内で `transactions` リストを直接走査し、その日の「入・出・在庫」を算出します。
    - これにより「関数が見つからない」というエラーは物理的に発生しなくなりました。

### 在庫推移とキャリーオーバー
- **初期在庫**: `useInventory` フックが算出する「（表示月の）月初在庫 (`startOfMonthStock`)」を基点としています。
- **累積計算**: 1日から末日に向かって `currentStock += In - Out` を順次実行し、計算結果を表示します。

### 大量購入インジケーター (BOSS ID)
- **統合**: インラインループ内にロジックを統合し、Strict v13.2 と同様の「赤三角マーク」と「BOSS IDツールチップ」を表示します。

## 2. 運用ルール
- 月を変更すると、全データが再計算され、新しい「月初在庫」から推移が描画されます。
- 万が一データ読み込みが遅れても、画面がクラッシュすることはありません（0または空欄が表示されます）。

----
This document serves as the absolute reference for the project (v13.3).
