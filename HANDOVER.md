# プロジェクト最終引き継ぎ書 (Strict v6)

**重要**: 本ドキュメントは 2026年2月17日時点の最終決定版です。
今後の開発において、本ドキュメントおよび `src/data.js` の定義から逸脱する変更は**厳禁**です。

## 1. 唯一の正解定義 (Single Source of Truth)

### 用語正規化ルール (`data.js`)
`normalizeTerm` 関数は、**以下のマップ定義のみ**を使用します。
複雑な `if` 文や `includes` 判定を復活させることは**禁止**です。

```javascript
const TERM_MAP = {
  '特別作戦': 'オプショナル',
  '特別作戦①': 'オプショナル①',
  '特別作戦②': 'オプショナル②',
  '特別作戦③': 'オプショナル③',
  'オプション①': 'オプショナル①',
  'オプション②': 'オプショナル②',
  'オプション③': 'オプショナル③',
  '競合商品': '他社商品',
  '質問10': 'Q10',
  'いん': 'アミノ酸',
  '有細胞子': '有胞子',
  'エネルギー': 'エナジー',
  '受け取り': '出庫入力',
  '受け取り入力': '出庫入力',
  '受取': '出庫入力',
  'ボス': 'BOSS'
};
```

### 商品カテゴリ順序 (`data.js`)
`CATEGORIES` 配列の順序・内容は固定です。
特に `オプショナル①〜③` を削除してはいけません（データマッピング用）。

```javascript
export const CATEGORIES = [
    "マルチ", "ビタミン", "ミネラル",
    "オプショナル", "オプショナル①", "オプショナル②", "オプショナル③",
    "他社商品", "本", "その他", "その他2", "カスタム", "予備"
];
```

## 2. システム構成

### 在庫表 (`InventoryTable.jsx`)
- **レイアウト**: 1日〜末日までの全日程リスト形式（2月なら28日分、最大31日分）。
- **土日表示**: 土曜＝青、日曜＝赤。
- **安全策**: データ不整合時は `try-catch` で捕捉し、「再読み込み」ボタンを表示。

### データベース (`localStorage`)
- **キー**: `inventory_v3` (v2以前は廃止)
- **マイグレーション**: アプリ起動時に `migration_v3_strict` が走り、上記 `TERM_MAP` に従っていないデータを強制変換します。

## 3. 運用・開発ルール
1.  **先祖返り禁止**: 「やっぱり `includes` であいまいに検索したい」といった要望が出ても、必ず `TERM_MAP` への追加で対応すること。
2.  **重複定義の禁止**: `data.js` に同じ関数を複数定義しないこと。
3.  **Render対応**: デプロイエラー時は `data.js` の構文エラー（括弧の閉じ忘れなど）を疑うこと。

----
This document supersedes all previous "Blueprint" or "Handover" notes.
